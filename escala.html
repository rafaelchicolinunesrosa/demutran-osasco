<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <title>Escalas - DEMUTRAN Osasco</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="stylesheet" href="css/style.css">
  <link rel="stylesheet" href="css/escala.css">
</head>
<body class="escala-page">
  <!-- Loading Overlay -->
  <div class="loading-overlay" id="loadingOverlay">
    <div class="loading-content">
      <div class="spinner"></div>
      <div id="loadingText">Processando...</div>
    </div>
  </div>

  <div class="escala-container">
    <a href="menu.html" class="back-btn">â† Voltar ao Menu</a>
    
    <div class="logos">
      <img src="logos/Logo demutran osasco.png" alt="Logo DEMUTRAN Osasco" onerror="this.style.display='none'">
      <img src="logos/logo agente de transito.png" alt="Logo Agente de TrÃ¢nsito" onerror="this.style.display='none'">
    </div>

    <h1>Escala de FiscalizaÃ§Ã£o - DEMUTRAN Osasco</h1>

   <!-- ConfiguraÃ§Ã£o JSONBin -->
<div class="config-section" id="configSection">
  <h3>
    <span>âš™ï¸</span>
    <span>ConfiguraÃ§Ã£o do Sistema (Primeiro Acesso)</span>
  </h3>
  <div class="config-info">
    <strong>ğŸ“‹ InstruÃ§Ãµes RÃ¡pidas:</strong>
    <ol>
      <li>Acesse: <a href="https://jsonbin.io" target="_blank">JSONBin.io</a></li>
      <li>Crie uma conta gratuita</li>
      <li>VÃ¡ em "API Keys" e copie sua <strong>Master Key</strong></li>
      <li>Cole a chave abaixo e clique em "Criar Banco de Dados"</li>
    </ol>
    <div style="background: rgba(255,255,255,0.15); padding: 8px; border-radius: 4px; margin-top: 8px; font-size: 0.85rem;">
      âš ï¸ <strong>IMPORTANTE:</strong> O sistema irÃ¡ reutilizar o banco existente automaticamente.<br>
      Seus dados nunca serÃ£o perdidos ao atualizar a pÃ¡gina!
    </div>
  </div>
  
  <label style="display: block; margin-top: 10px; font-weight: bold;">JSONBin Master Key:</label>
  <input type="password" id="apiKey" placeholder="$2a$10$xxxxxxxxxxxxxxxxxxxxx">
  
  <div>
    <button type="button" onclick="createDatabase()">ğŸš€ Criar/Configurar Banco</button>
    <button type="button" onclick="testConnection()">ğŸ” Testar ConexÃ£o</button>
    <button type="button" onclick="resetConfig()" style="background: #dc3545; color: white;">ğŸ”„ Resetar Config</button>
  </div>
  
  <div class="status" id="configStatus"></div>
</div>

    <div class="info-template">
      <strong>ğŸ’¡ Como funciona o sistema:</strong>
      <ul>
        <li><strong>MÃºltiplos PlantÃµes no Mesmo Dia:</strong> Cada plantÃ£o salva separadamente, sem conflitos.</li>
        <li><strong>Salvamento em Nuvem:</strong> Dados salvos no JSONBin, acessÃ­veis de qualquer lugar.</li>
        <li><strong>Gerar PDF:</strong> Use Ctrl+P ou o botÃ£o de impressÃ£o para salvar como PDF.</li>
        <li><strong>Busca Inteligente:</strong> Veja todas as escalas salvas por data e plantÃ£o.</li>
      </ul>
    </div>

    <form id="escalaForm">
      <div class="dados-gerais">
        <div>
          <label for="data">Data:</label>
          <input type="date" id="data" name="data" required>
        </div>
        <div>
          <label for="diaSemana">Dia da Semana:</label>
          <select id="diaSemana" name="diaSemana" required>
            <option value="">Selecione...</option>
            <option value="Segunda-feira">Segunda-feira</option>
            <option value="TerÃ§a-feira">TerÃ§a-feira</option>
            <option value="Quarta-feira">Quarta-feira</option>
            <option value="Quinta-feira">Quinta-feira</option>
            <option value="Sexta-feira">Sexta-feira</option>
            <option value="SÃ¡bado">SÃ¡bado</option>
            <option value="Domingo">Domingo</option>
          </select>
        </div>
        <div>
          <label for="tipoOperacao">PlantÃ£o:</label>
          <select id="tipoOperacao" name="tipoOperacao" required>
            <option value="">Selecione...</option>
            <option value="PlantÃ£o A">PlantÃ£o A</option>
            <option value="PlantÃ£o B">PlantÃ£o B</option>
            <option value="PlantÃ£o C">PlantÃ£o C</option>
            <option value="PlantÃ£o D">PlantÃ£o D</option>
          </select>
        </div>
        <div>
          <label for="supervisor">Supervisor do PlantÃ£o:</label>
          <input type="text" id="supervisor" name="supervisor" required>
        </div>
      </div>

      <div class="turnos-selector" id="turnosSelector">
        <div class="turnos-selector-title">Selecionar Turnos para exibir:</div>
      </div>

      <div id="turnosContainer"></div>

      <div class="observacoes-section">
        <label for="observacoes"><strong>ObservaÃ§Ãµes Gerais:</strong></label><br>
        <textarea id="observacoes" name="observacoes" class="auto-grow" rows="3" placeholder="AnotaÃ§Ãµes gerais do dia, intercorrÃªncias, orientaÃ§Ãµes..."></textarea>
      </div>

      <div class="assinatura-section">
        <div class="linha-assinatura">Assinatura</div>
      </div>

      <div class="btn-actions">
        <div class="action-group local">
          <div class="action-title">Templates Locais</div>
          <div class="action-buttons">
            <button type="button" class="action-btn" onclick="saveTemplate()">ğŸ’¾ Salvar Template</button>
            <button type="button" class="action-btn" onclick="loadTemplate()">ğŸ“‚ Carregar Template</button>
          </div>
        </div>
        
        <div class="action-group cloud">
          <div class="action-title">â˜ï¸ Nuvem (JSONBin)</div>
          <div class="action-buttons">
            <button type="button" class="action-btn" onclick="saveToCloud()">ğŸ’¾ Salvar na Nuvem</button>
            <button type="button" class="action-btn" onclick="loadFromCloud()">ğŸ“¥ Carregar da Nuvem</button>
            <button type="button" class="action-btn" onclick="listAllScales()">ğŸ“‹ Ver Todas</button>
          </div>
        </div>
      </div>
      
      <div class="print-section">
        <button type="button" class="print-btn" onclick="window.print()">
          ğŸ–¨ï¸ Imprimir / Salvar PDF (Ctrl+P)
        </button>
      </div>
    </form>
  </div>

  <script src="js/auth.js"></script>
  <script src="js/config.js"></script>
  <script src="js/escala.js"></script>
  <script>
    // Verificar autenticaÃ§Ã£o
    if (!isAuthenticated()) {
      window.location.href = 'index.html';
    }

    // Inicializar sistema
    window.addEventListener('load', function() {
      initEscalaSystem();
    });
  </script>
</body>
</html>

